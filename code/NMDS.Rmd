---
title: "NMDS Rmd"
output: html_document
editor_options: 
  chunk_output_type: console
---
#NMDS of all species together
LP edits: 
- Removed unnecessary code
- Streamlined # of different datasets (shorebird1 vs shorebird2 etc. condensed to be shorebird)
```{r setup, include=FALSE}

# no need to set wd if in a project on your computer cloned from github
# i have changed the file extensions to work with the project and should work across computers

#setwd("~/Desktop/CNP_internship/LS_Data")

##### packages #####
library(readxl)
library(grDevices)
library(tidyverse)
library(janitor)
library(ggdark)
library(Hmisc)
library(broom)
library(viridis)
library(lubridate)
library(vegan) #for RDA
library(ggpubr)
library(rstatix)
library(broom)
library(purrr)
library(labdsv) #hellinger transformation

##### load data #####

#shorebird data
shorebird<-read_excel("data/Shorebird_People_Data/Shorebird_People_Data.xlsx")

# target data (needs alignment - spp lists differ by year)
target <- read_excel('data/RI_Long_Term_Data/Photoplot_summary_by_plot_20210414.xlsx')

# alignment info for target data 
align <- read_csv('data/TGT_all.csv')
# see RI_Species_Alighment_Feb21.R for methods
# summary: took species lists for 1990 and 2000, applied to all unique spp.

```

```{r}
##### presets #####
# lists of commonly filtered-for items
cabrsites <- c('CAB1', 'CAB2', 'CAB3') 
zonelist <- c('CHT', unique(target$Zone)[1:4])
zonenames <- c('Balanus/Chthamalus', 'Tetraclita rubescens', 'Mussel', 'Silvetia compressa', 'Pollicipes polymerus')
targetlist <- c('CHTBAL', 'TETRUB', 'MUSSEL', 'SILCOM', 'POLPOL')

# theme
lltheme_dark <- dark_theme_bw() + theme(text = element_text(size = 12),
                              # add more space between panels
                              panel.spacing = unit(1, 'lines'),
                              # no background to wrap panels
                              strip.background = element_blank(),
                              strip.text = element_text(size = 12, hjust = 0),
                              # panel labels outside x axis labels
                              strip.placement = 'outside',
                              # adjust x axis labels
                              axis.text.y = element_text(size = 12),
                              axis.text.x = element_text(size = 12, angle = 45, hjust = 1))

lltheme_light <- theme_bw() + theme(text = element_text(size = 12),
                              # add more space between panels
                              panel.spacing = unit(1, 'lines'),
                              # no background to wrap panels
                              strip.background = element_blank(),
                              strip.text = element_text(size = 12, hjust = 0),
                              # panel labels outside x axis labels
                              strip.placement = 'outside',
                              # adjust x axis labels
                              axis.text.y = element_text(size = 12),
                              axis.text.x = element_text(size = 12, angle = 45, hjust = 1))
```

```{r}
######## tidy: shorebird data #####

#add column with just years
shorebird$Year=format(shorebird$SurveyDate, "%Y")

#filter for just people
shorebird<- ungroup(shorebird) %>% 
  mutate(SurveyYear=year(SurveyDate))%>%
  filter(DataType=="People")%>%
  group_by(SurveyYear, ZoneClass) %>% #separate by year and zone
  summarise(people=mean(DataCount)) %>% #get average counts
  mutate(ZoneName= paste('Zone', ZoneClass),
         Panel = if_else(ZoneName == 'Zone I', 'A', 
                         if_else(ZoneName == 'Zone II', 'B', 'C'))) %>%
  mutate(ZoneName = paste('(', Panel, ') ', ZoneName, sep = '')) %>%
  select(-c(Panel))%>%
  drop_na()
```

```{r}
##### tidy: photoplot #####
# adapted from B. Hong's 2019-2021 Annual Report Code

# keep target raw, retains plot-level data, and tidy
target <- 
  # add generic codes to this set, along with formatted scientific names
  left_join(target, align, by = 'SpeciesCode') %>%
  # only get cabr sites
  filter(SiteCode %in% cabrsites) %>%
  # get rid of old scientific name (align has better one)
  select(-c(Scientific_name.x)) %>%
  # rename scientific name column
  rename(Scientific_name = Scientific_name.y) %>%
  # make plot number a numeric column
  mutate(Plot_num = parse_number(substr(Plot_code, 6,6))) %>%
  # add zone/site column
  mutate(ZoneName = paste('Zone', substr(SiteName, 10, 12)),
         Panel = if_else(SiteName == 'Cabrillo I', 'A', 
                         if_else(SiteName == 'Cabrillo II', 'B', 'C'))) %>%
  mutate(ZoneName = paste('(', Panel, ') ', ZoneName, sep='')) %>%
  # only get unique rows (removes duplicates)
  distinct()

unique(target$ZoneName)==unique(shorebird$ZoneName)

#### group by categories in 1990 ####

# get sum of number of points for each species
target_1990 <- target %>%
  group_by(SiteCode, SiteName, ZoneName, SurveyYear, Zone, Plot_num, Plot_code, Code_1990) %>%
  summarise(cover = sum(N))

# get number of points/quadrat to calculate% cover
target_summary <- target %>%
  group_by(SiteCode, SiteName, ZoneName, SurveyYear, Zone, Plot_num, Plot_code) %>% 
  summarise(points = sum(N))


target_1990 <- left_join(target_1990, target_summary, by = c("SiteCode", "SiteName", "ZoneName", "SurveyYear", "Zone", "Plot_num", "Plot_code")) %>%
  group_by(SiteCode, ZoneName, SiteName, SurveyYear, Zone, Plot_num, Plot_code, Code_1990) %>%
  mutate(pct_cover = (cover/points)*100) %>%
  select(SiteCode, SiteName, ZoneName, SurveyYear, Zone, Plot_num, Plot_code, Code_1990, pct_cover) %>%
  rename(SpeciesCode = Code_1990) %>%
  filter(SiteName %in% c("Cabrillo I", "Cabrillo II", "Cabrillo III"))

# join spp names to 1990 data
spplist <- align %>%
  select(SpeciesCode, Scientific_name) %>%
  distinct()

target_1990 <- left_join(target_1990, spplist, by = "SpeciesCode")

target_1990_1<-target_1990[,-c(6:8)]

# remove extras
remove(target_summary, align, spplist, target)

# get cover of species in their "home" plots
# for line plots and trend lines of home spp over time and vs people
target_90_home <- ungroup(target_1990) %>%
filter(SiteCode %in% cabrsites) %>%
# filter to only tgt spp in their own plots
filter((Zone == 'CHT' & SpeciesCode %in% c('TETRUB', 'CHTBAL')) |
(Zone == 'MYT' & SpeciesCode == 'MUSSEL') |
(Zone == 'SIL' & SpeciesCode == 'SILCOM') |
(Zone == 'POL' & SpeciesCode == 'POLPOL')) %>%
# get mean + SE cover for each yr
group_by(ZoneName, SurveyYear, Zone, SpeciesCode, Scientific_name) %>%
summarise(Cover_mean = mean(pct_cover), #keep if want each year to have 1 point
Cover_SE = sd(pct_cover)/sqrt(length(pct_cover)))

#rotate from long to wide
target_new <- select(target_1990, -Scientific_name) %>% pivot_wider(names_from = SpeciesCode, values_from = pct_cover)%>%
  mutate_all(~replace(., is.na(.), 0)) %>%
  # remove blank "na" column
  select(-`NA`)

#combine shorebird data and wide format target spp abundance data
target_shore<-left_join(target_new, shorebird[,-c(2)], by = c("ZoneName", "SurveyYear"))%>%
  drop_na()
```

## Regression approach

Goal - assess relationships between visitation and year on target spp abundance
Approach - gam (spp abundance ~ year + visitation + zone)
Results - 

```{r Target spp gam approach}
# get grand means and join w/ plot data
target_90_home <- left_join(left_join(target_90_home, 
                            target_90_home %>% group_by(SpeciesCode)%>%
                            summarise(grand_mean = mean(Cover_mean)), 
                            by = c('SpeciesCode')),
                    # join with bird data
                  select(shorebird, -ZoneClass)) %>%
                  # first word of scientific name
                  mutate(Scientific_name = case_when(
                         Scientific_name == 'Mussel' ~ 'Mytilus',
                         TRUE ~ word(Scientific_name)),
                  # remove panel letters from zones (i.e. (A))
                  ZoneName = substr(ZoneName, 5, nchar(ZoneName)))

# write function to run GAM (cover ~ year + people + zone) for each spp
gam_fn <- function(spp_name, outputname) {
  
  # subset data 
  gam_data <- target_90_home %>%
    filter(Scientific_name == spp_name) 
  
  # run GAM
  gam_mod <- gam(Cover_mean ~ s(SurveyYear) + s(people) + s(ZoneName), data = gam_data)
  
  # 
  
  
}

    # save plots to assess model fit
    # https://data.library.virginia.edu/diagnostic-plots/
    grDevices::pdf(file = paste('figures/GAM_', gsub('/', '', spp_list[i]), '.pdf', sep = ''))
    plot(gam_mod)
    dev.off()
    
    




# plot figures (uses ggdark theme) - over time with grand mean
# panel plot for annual report

base_lineplot_function <- function(lightdark, grandmean_yesno, error_yesno) {
  
ggplot(data = target_90_home,
       mapping = aes(x = SurveyYear, y = Cover_mean, group = ZoneName)) + 
  geom_hline(aes(yintercept = grand_mean), linetype = 'dashed', color = 'white') + 
  geom_linerange(mapping = aes(x = SurveyYear, 
                               ymin = (Cover_mean - Cover_SE),
                               ymax = (Cover_mean + Cover_SE)),
                 color = 'gray70', size = 1) +
  geom_line(aes(color = ZoneName), size = 1) + 
  geom_point(aes(color = ZoneName), size = 2) + 
  scale_color_viridis(discrete = TRUE, begin = 0.4, end = 1, name = 'Site') +
  xlab('Year') + 
  ylab('Percent cover') +
  facet_wrap(~Scientific_name, scales = 'free_y') + 
  coord_cartesian(xlim = c(1990, 2020)) + 
  scale_x_continuous(breaks = c(1990, 1995, 2000, 2005, 2010, 2015, 2020))  +
  lltheme_light

ggsave('figures/Photoplot_TimeSeries_GrandMean.png', dpi = 600, width = 12)

# dark theme plot

```


```{r}
#separate out people/year from target_shore
environ<-target_shore[c(1,2,3,4,5,18)] #tree

#separate out species matrix, including linking factors
species<-target_shore[c(1,2,3,8,9,10,11,12,13,14,15,16)] #bird
```

```{r}
#permanova- following rpubs.com/collnell/manova

#make matrix
species.matrix<-as.matrix(species[,5:9])

#standardize with sqrt
species.mat<-sqrt(species.matrix)

#find ecological resemblance
species.dist<-vegdist(species.mat, method='bray')

species.div<-adonis2(species.dist~ZoneName, data=species, permutations = 999, method='bray',strata = "PLOT")
species.div #issue with strata. ran w/out strata and pvalue=0.001

dispersion<-betadisper(species.dist, group=species$ZoneName)
permutest(dispersion) #pvalue=0.678

plot(dispersion, hull=F, ellipse=T) #just zone III shows up
```

#NMDS
#zone 3 NMDS
```{r}

color<-tibble(ZoneName=unique(species$ZoneName), Colors=c("green", "red", "blue"))

#make matrix
#9445 first row of zone3, 14028
#zone3.matrix<-as.matrix(select(species[which(species$ZoneName=="(C) Zone III")], -c("SiteCode","SiteName","ZoneName")))

zone3.matrix<-ungroup(species)%>% #ungroup b/c r wants to group first 3 columns
  filter(ZoneName=="(C) Zone III")%>% #filter by zone 3 for zone 3 nmds
  select(-c(1:3))%>% #take out non-num variables to be able to square
  as.matrix() #make matrix

#standardize with sqrt
zone3.mat<-sqrt(zone3.matrix)

#remove matrix rows with all 0s to run MDS? Error
#zone3.matrix=zone3.matrix[, colSums(count != 0) > 0]

zone3MDS<-metaMDS(zone3.mat, distance="bray", k=3, trymax = 35, autotransform = T) #stress=0.1252488
zone3MDS

stressplot(zone3MDS)

#graph doesn't work
NMDS1zone3<-zone3MDS$points[,1]
NMDS2zone3<-zone3MDS$points[,2]

zone3species<-species[which(species$ZoneName=="(C) Zone III"),]
zone3environ<-environ[which(environ$ZoneName=="(C) Zone III"),]
zone3species.plot<-cbind(zone3species, NMDS1zone3, NMDS2zone3, zone3environ)
#remove repeating columns
zone3species.plot<-zone3species.plot[-c(15:17)]
zone3species.plot<-left_join(zone3species.plot, color)


p<-ggplot(zone3species.plot, aes(NMDS1zone3, NMDS2zone3, color=Zone))+
  stat_ellipse(type='t',size = 1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  annotate("text", x=min(NMDS1zone3), y=min(NMDS2zone3), label=paste('Stress =',round(zone3MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone3species.plot, aes(NMDS1zone3, NMDS2zone3, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))
p #make diff shapes for each Zone (species)
#polpol in zone 1 are similar to polpol in zone 2 and 3. pol and cht same across all zones. Myt and sil differs across zones more. 
#sil and myt diff in zone 1 than other zones

#fit mussel environ
mus.zone3 <- target_shore %>%
  filter(Zone == 'MYT'&ZoneName=="(C) Zone III") %>%
  select(-c(SiteCode:Zone, people))

mus.envzone3 <- target_shore %>%
  filter(Zone == 'MYT'&ZoneName=="(C) Zone III") %>%
  select(SiteName, SurveyYear, people)

musMDSzone3<-metaMDS(mus.zone3, distance= "bray", k = 2, trymax = 35, autotransform = T)
fitzone3<-envfit(musMDSzone3, mus.envzone3)
arrowzone3<-data.frame(fitzone3$vectors$arrows,R = fitzone3$vectors$r, P = fitzone3$vectors$pvals)
arrowzone3$FG <- rownames(arrowzone3)
arrow.pzone3<-filter(arrowzone3, P <= 0.05)


#graph with arrows as environmental variables
ggplot(zone3species.plot, aes(NMDS1zone3, NMDS2zone3))+
  #geom_point(data=zone3species.plot, aes(NMDS1zone3, NMDS2zone3, color=Zone),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=Zone), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.pzone3, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrowzone3=arrow(length=unit(.2, "cm")*arrow.pzone3$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1zone3), y=min(NMDS2zone3), label=paste('Stress =',round(zone3MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone3species.plot, aes(NMDS1zone3, NMDS2zone3, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))
ggsave("NMDS_zone3.png", width=6, height=4)

#graph with ellipses as zone
ggplot(zone3species.plot, aes(NMDS1zone3, NMDS2zone3))+
  #geom_point(data=zone3species.plot, aes(NMDS1zone3, NMDS2zone3, color=Zone),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=ZoneName), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.pzone3, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrowzone3=arrow(length=unit(.2, "cm")*arrow.pzone3$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1zone3), y=min(NMDS2zone3), label=paste('Stress =',round(zone3MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone3species.plot, aes(NMDS1zone3, NMDS2zone3, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))+
  scale_fill_manual(values=zone3species.plot$Colors)
ggsave("NMDS_zone3ellip.png", width=6, height=4)

```

#NMDS with zone 2 and 3
```{r}
#make matrix
zone23.matrix<-as.matrix(species[104:305,4:9])

#standardize with sqrt
zone23.mat<-sqrt(zone23.matrix)

zone23MDS<-metaMDS(zone23.mat, distance="bray", k=2, trymax = 35, autotransform = T) #stress=0.1252488
zone23MDS

stressplot(zone23MDS)

#graph doesn't work
NMDS1zone23<-zone23MDS$points[,1]
NMDS2zone23<-zone23MDS$points[,2]

zone23species<-species[which(species$ZoneName!="(A) Zone I"),]
zone23environ<-environ[which(species$ZoneName!="(A) Zone I"),]
zone23species.plot<-cbind(zone23species, NMDS1zone23, NMDS2zone23, zone23environ)
#remove repeating columns
zone23species.plot<-zone23species.plot[-c(15:17)]
zone23species.plot<-left_join(zone23species.plot, color)

ggplot(zone23species.plot, aes(NMDS1zone23, NMDS2zone23, color=Zone))+
  stat_ellipse(type='t',size = 1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  annotate("text", x=min(NMDS1zone23), y=min(NMDS2zone23), label=paste('Stress =',round(zone23MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone23species.plot, aes(NMDS1zone23, NMDS2zone23, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))
#make diff shapes for each Zone (species)
#polpol in zone 1 are similar to polpol in zone 2 and 3. pol and cht same across all zones. Myt and sil differs across zones more. 
#sil and myt diff in zone 1 than other zones

#fit mussel environ
mus.zone23 <- target_shore %>%
  filter(Zone == 'MYT'& ZoneName!="(A) Zone I") %>%
  select(-c(SiteCode:Zone, people))

mus.envzone23 <- target_shore %>%
  filter(Zone == 'MYT'& ZoneName!="(A) Zone I") %>%
  select(SiteName, SurveyYear, people)

musMDSzone23<-metaMDS(mus.zone23, distance= "bray", k = 2, trymax = 35, autotransform = T)
fitzone23<-envfit(musMDSzone23, mus.envzone23)
arrowzone23<-data.frame(fitzone23$vectors$arrows,R = fitzone23$vectors$r, P = fitzone23$vectors$pvals)
arrowzone23$FG <- rownames(arrowzone23)
arrow.pzone23<-filter(arrowzone23, P <= 0.05)

#graph with arrows as environmental variables
ggplot(zone23species.plot, aes(NMDS1zone23, NMDS2zone23))+
  #geom_point(data=zone23species.plot, aes(NMDS1zone23, NMDS2zone23, color=Zone),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=Zone), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.pzone23, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrowzone23=arrow(length=unit(.2, "cm")*arrow.pzone23$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1zone23), y=min(NMDS2zone23), label=paste('Stress =',round(zone23MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone23species.plot, aes(NMDS1zone23, NMDS2zone23, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))
ggsave("NMDS_zone23.png", width=6, height=4)

#graph with ellipses as zones
ggplot(zone23species.plot, aes(NMDS1zone23, NMDS2zone23))+
  #geom_point(data=zone23species.plot, aes(NMDS1zone23, NMDS2zone23, color=Zone),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=ZoneName), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.pzone23, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrowzone23=arrow(length=unit(.2, "cm")*arrow.pzone23$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1zone23), y=min(NMDS2zone23), label=paste('Stress =',round(zone23MDS$stress,3)))+ #add stress to plot
  geom_point(data=zone23species.plot, aes(NMDS1zone23, NMDS2zone23, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))+
  scale_fill_manual(values=unique(zone23species.plot$Colors))
ggsave("NMDS_zone23ellip.png", width=6, height=4)
```

#All zones NMDS
```{r}
color<-tibble(ZoneName=unique(species$ZoneName), Colors=c("green", "red", "blue"))

#remove repeating columns
zone3species.plot<-zone3species.plot[-c(15:17)]
zone3species.plot<-left_join(zone3species.plot, color)
speciesMDS<-metaMDS(species.mat, distance="bray", k=2, trymax = 35, autotransform = T) #stress=0.1572664
speciesMDS

stressplot(speciesMDS)

#graph doesn't work
NMDS1<-speciesMDS$points[,1]
NMDS2<-speciesMDS$points[,2]
species.plot<-cbind(species, NMDS1, NMDS2, environ)
species.plot<-species.plot[-c(15:17)]
species.plot<-left_join(species.plot, color)

p<-ggplot(species.plot, aes(NMDS1, NMDS2, color=ZoneName))+
  stat_ellipse(type='t',size = 1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  #geom_text(data=species.plot, aes(NMDS1, NMDS2, label=Zone))+ #position=position_jitter(.35))+
  annotate("text", x=min(NMDS1), y=min(NMDS2), label=paste('Stress =',round(speciesMDS$stress,3)))+ #add stress to plot
  geom_point(data=species.plot, aes(NMDS1, NMDS2, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))
p #make diff shapes for each Zone (species)
#polpol in zone 1 are similar to polpol in zone 2 and 3. pol and cht same across all zones. Myt and sil differs across zones more. 
#sil and myt diff in zone 1 than other zones

#fit environmental variables
#fit<-envfit(speciesMDS, species.mat)
#arrow<-data.frame(fit$vectors$arrows,R = fit$vectors$r, P = fit$vectors$pvals)
#arrow$FG <- rownames(arrowsil)
#arrow.p<-filter(arrowsil, P <= 0.05)

#fit mussel environ
mus.species <- target_shore %>%
  filter(Zone == 'MYT') %>%
  select(-c(SiteCode:Zone, people))

mus.env <- target_shore %>%
  filter(Zone == 'MYT') %>%
  select(SiteName, SurveyYear, people)

musMDS<-metaMDS(mus.species, distance= "bray", k = 2, trymax = 35, autotransform = T)
fit<-envfit(musMDS, mus.env)
arrow<-data.frame(fit$vectors$arrows,R = fit$vectors$r, P = fit$vectors$pvals)
arrow$FG <- rownames(arrow)
arrow.p<-filter(arrow, P <= 0.05)

ggplot(data=species.plot, aes(NMDS1, NMDS2))+
  geom_point(data=species.plot, aes(NMDS1, NMDS2, color=ZoneName),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=ZoneName), alpha=.2,type='t',size =1, geom="polygon")+ ##changes shading on ellipses
  theme_minimal()+
  geom_segment(data=arrow.p, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrow=arrow(length=unit(.2, "cm")*arrow.p$R)) ##add arrows (scaled by R-squared value)

#graph with arrows of how species differ
ggplot(species.plot, aes(NMDS1, NMDS2))+
  #geom_point(data=species.plot, aes(NMDS1, NMDS2, color=ZoneName),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=Zone), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.p, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrow=arrow(length=unit(.2, "cm")*arrow.p$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1), y=min(NMDS2), label=paste('Stress =',round(speciesMDS$stress,3)))+ #add stress to plot
  geom_point(data=species.plot, aes(NMDS1, NMDS2, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))

#graph with arrows as environmental variables
ggplot(species.plot, aes(NMDS1, NMDS2))+
  #geom_point(data=species.plot, aes(NMDS1, NMDS2, color=ZoneName),position=position_jitter(.1))+##separates overlapping points
  stat_ellipse(aes(fill=ZoneName), alpha=.2,type='t',size =1, geom="polygon")+
  theme_minimal()+
   geom_segment(data=arrow.p, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label=FG, lty=FG), arrow=arrow(length=unit(.2, "cm")*arrow.p$R))+ ##add arrows (scaled by R-squared value)
  annotate("text", x=min(NMDS1), y=min(NMDS2), label=paste('Stress =',round(speciesMDS$stress,3)))+ #add stress to plot
  geom_point(data=species.plot, aes(NMDS1, NMDS2, shape=Zone))+
  scale_shape_manual(values=c(3,16,17,18))+
  scale_fill_manual(values=unique(species.plot$Colors))
ggsave("NMDS_allzones.png", width=6, height=4)

#R values sig for both people and survey year.
#people arrow driving x axis, associated with mussels
#Survey year driving y axis, not really associated with specific species. 
```

#plot zone 1 first. Then add zone 2 and 3. Or start zone 3 (no people), add zone 2 and 1 (show diff because of people on mussel communities)
